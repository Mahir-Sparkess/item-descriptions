datasets:
  - /neodc/sentinel5p/data
facets:
  extraction_methods:
    - name: regex
      description: Extract facets from the file path
      inputs:
        regex: '^\/(?:[^/]*/)(?P<platform>\w*)(?:[^/]*/){3}(?P<product_version>[0-9v.]+)/'
    - name: regex
      description: Extract facets from the filename
      inputs:
        regex: '^(?:[^_]*_){2}(?P<processing_level>[A-Za-z0-9]+)__(?P<variable>[a-zA-Z0-9]+)_{4}(?P<start_datetime>[0-9T]+)_(?P<end_datetime>[0-9T]+)_(?P<orbit>\d+)(?:[^_]*_){3}(?P<datetime>[0-9T]+)'
      pre_processors:
        - name: filename_reducer
      post_processors:
        - name: isodate_processor
          inputs:
            date_keys:
              - start_datetime
              - end_datetime
              - datetime
    - name: header_extract
      description: Extract header metadata
      inputs:
       attributes:
         - institution
         - sensor
         - title
    - name: header_extract
      description: Extract BBox from header
      output_key: bbox
      inputs:
       attributes:
         - geospatial_lat_min
         - geospatial_lat_max
         - geospatial_lon_min
         - geospatial_lon_max
      post_processors:
        - name: stac_bbox
          inputs:
            key_list:
              - geospatial_lon_min
              - geospatial_lat_min
              - geospatial_lon_max
              - geospatial_lat_max
  aggregation_facets:
    - platform
    - processing_level
    - variable
    - product_version
    - datetime
